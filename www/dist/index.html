<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Robot Motor Control</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            font-family: Arial;
            margin: 20px;
            background: #f0f0f0
        }

        .container {
            max-width: 600px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1)
        }

        .motor-group {
            margin: 15px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px
        }

        .motor-row {
            display: flex;
            align-items: center;
            margin: 5px 0
        }

        .motor-row label {
            width: 100px;
            display: inline-block
        }

        .motor-row input {
            width: 100px;
            margin: 0 10px;
            padding: 5px
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer
        }

        button:hover {
            background: #0056b3
        }

        .status {
            background: #e9ecef;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace
        }

        .limits {
            font-size: 12px;
            color: #666
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Robot Motor Control</h1>
        <div class="motor-group">
            <h3>Movimiento Relativo</h3>
            <div class="motor-row"><label>Motor 1:</label><input type="number" id="m1" value="0"><span
                    class="limits">[0-3200]</span></div>
            <div class="motor-row"><label>Motor 2:</label><input type="number" id="m2" value="0"><span
                    class="limits">[0-2100]</span></div>
            <div class="motor-row"><label>Motor 3:</label><input type="number" id="m3" value="0"><span
                    class="limits">[0-700]</span></div>
            <div class="motor-row"><label>Duracion:</label><input type="number" id="dur" value="1" step="0.1">s</div>
            <button onclick="sendMove()">Mover Relativo</button>
        </div>
        <div class="motor-group">
            <h3>Movimiento Absoluto</h3>
            <div class="motor-row"><label>Pos X:</label><input type="number" id="x1" value="0"></div>
            <div class="motor-row"><label>Pos Y:</label><input type="number" id="y1" value="0"></div>
            <div class="motor-row"><label>Pos Z:</label><input type="number" id="z1" value="0"></div>
            <div class="motor-row"><label>Duracion:</label><input type="number" id="dur2" value="2" step="0.1">s</div>
            <button onclick="sendMoveTo()">Ir a Posicion</button>
        </div>
        <div class="motor-group">
            <h3>Control</h3>
            <button onclick="getPos()">Posicion</button>
            <button onclick="getStatus()">Estado</button>
            <button onclick="resetPos()">Reset</button>
            <button onclick="getLimits()">Limites</button>
            <button onclick="enableMotors()" style="background:#28a745">Habilitar Motores</button>
            <button onclick="disableMotors()" style="background:#6c757d">Deshabilitar Motores</button>
            <button onclick="emergencyStop()" style="background:#dc3545">STOP</button>
            <button onclick="restartESP32()" style="background:#ff6b35">REINICIAR ESP32</button>
        </div>
        <div class="motor-group">
            <h3>Control de Spindle</h3>
            <button onclick="spindleOn()" style="background:#ffc107;color:#000">Spindle ON</button>
            <button onclick="spindleOff()" style="background:#6c757d">Spindle OFF</button>
        </div>
        <div class="status" id="status">Sistema Listo</div>
    </div>
    <script>
        function updateStatus(msg) { document.getElementById('status').innerHTML = msg; }
        function sendCommand(cmd) {
            updateStatus('Enviando: ' + cmd);
            fetch('/api/command', { method: 'POST', headers: { 'Content-Type': 'text/plain' }, body: cmd })
                .then(r => r.json()).then(data => {
                    if (data.status === 'ok') updateStatus('OK: ' + data.message);
                    else updateStatus('Error: ' + data.message);
                    setTimeout(getStatus, 500);
                }).catch(e => updateStatus('Error de conexion: ' + e));
        }
        function getStatus() {
            fetch('/api/status').then(r => r.json()).then(data => {
                if (data.last_response) updateStatus('Estado: ' + data.last_response);
            }).catch(e => console.log('Error getting status:', e));
        }
        function sendMove() {
            var m1 = document.getElementById('m1').value;
            var m2 = document.getElementById('m2').value;
            var m3 = document.getElementById('m3').value;
            var dur = document.getElementById('dur').value;
            sendCommand('MOVE ' + m1 + ' ' + m2 + ' ' + m3 + ' ' + dur);
        }
        function sendMoveTo() {
            var x = document.getElementById('x1').value;
            var y = document.getElementById('y1').value;
            var z = document.getElementById('z1').value;
            var dur = document.getElementById('dur2').value;
            sendCommand('MOVETO ' + x + ' ' + y + ' ' + z + ' ' + dur);
        }
        function getPos() { sendCommand('POS'); }
        function resetPos() { sendCommand('RESET'); }
        function getLimits() { sendCommand('LIMITS'); }
        function enableMotors() { sendCommand('ENABLE'); }
        function disableMotors() { sendCommand('DISABLE'); }
        function emergencyStop() { sendCommand('STOP'); }
        function spindleOn() { sendCommand('SPINDLE_ON'); }
        function spindleOff() { sendCommand('SPINDLE_OFF'); }
        function restartESP32() { if (confirm('¿Estás seguro de que quieres reiniciar la ESP32?')) { sendCommand('RESTART'); } }
        window.onload = function () { getStatus(); setInterval(getStatus, 10000); }
    </script>
</body>

</html>